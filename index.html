<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Preopercionales Transelite</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0d6efd" />
  <style>
    :root{
      --bg: linear-gradient(135deg,#0e205a 0%,#f7f9ff 50%,#eef6ff 100%);
      --ink:#0b1022; --muted:#6b7280; --card:#ffffff; --ring:#dbe4ff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg); color:var(--ink);
    }
    header{
      position:sticky; top:0; background:rgba(255,255,255,.85); backdrop-filter:blur(8px);
      border-bottom:1px solid #e5e7eb; padding:10px 16px; z-index:10
    }
    .title{font-weight:600}
    .wrap{
      max-width:1100px; margin:auto; padding:10px; display:grid; gap:10px;
    }
    .frame-wrap{
      background:var(--card); border:1px solid #e5e7eb; border-radius:16px;
      box-shadow:0 10px 30px rgba(2,8,20,.08); overflow:hidden; position:relative;
    }
    iframe{
      display:block; width:100%; border:0;
      /* Fallback: ocupa el alto de la ventana si no hay auto-resize */
      min-height:100dvh;
    }
    .loader{
      position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
      background:linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.6));
      transition:opacity .25s ease; pointer-events:none;
    }
    body.ready .loader{ opacity:0; }
    .spinner{
      width:36px; height:36px; border-radius:50%;
      border:3px solid #c7d2fe; border-top-color:#4f46e5; animation:spin 1s linear infinite;
    }
    @keyframes spin { to { transform:rotate(360deg) } }
    .hint{font-size:12px; color:var(--muted); text-align:center; padding:6px 0 10px}
    a.btn{
      display:inline-block; padding:8px 12px; border:1px solid #c7d2fe; border-radius:10px; text-decoration:none;
      color:#1d4ed8; background:#eef2ff;
    }
  </style>
</head>
<body>
  <header>
    
    </div>
  </header>

  <main class="wrap">
    <div class="frame-wrap">
      <div class="loader"><div class="spinner" aria-label="Cargando…"></div></div>

      <!-- IFRame -->
      <iframe
        id="appscript"
        title="Mi WebApp"
        src="https://script.google.com/macros/s/AKfycbzYnxGk_9TuQrn8BPqI7UgJ0OjlgjcCHwxtwtmrqmKNGriBmzMvlVs9VOXAk9afMvk/exec"
        allow="clipboard-read; clipboard-write; camera; microphone; geolocation; fullscreen"
        referrerpolicy="strict-origin-when-cross-origin"
      ></iframe>
    </div>
  </main>

  <script>
    // Marcar listo al cargar para ocultar el loader
    const iframe = document.getElementById('appscript');
    iframe.addEventListener('load', () => document.body.classList.add('ready'));

    // Auto-ajuste de altura (funciona si la WebApp envía postMessage; ver snippet más abajo)
    const ALLOWED_ORIGINS = new Set([
      'https://script.google.com',
      'https://script.googleusercontent.com'
    ]);

    window.addEventListener('message', (ev) => {
      try {
        if (!ALLOWED_ORIGINS.has(ev.origin)) return;
      } catch { return; }

      if (ev.data && ev.data.type === 'appsScriptHeight') {
        const h = Math.max(320, Math.min(Number(ev.data.height || 0), 8000));
        iframe.style.height = h + 'px';
      }
    });

    // Fallback: asegura mínimo alto de viewport si no hay auto-resize
    function setViewportHeight(){
      iframe.style.minHeight = Math.max(window.innerHeight || 600, 600) + 'px';
    }
    setViewportHeight();
    window.addEventListener('resize', setViewportHeight);
  </script>
</body>
</html>
